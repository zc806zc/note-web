# JS面向对象

- 传统的面向对象 C++ Java PHP Objective-C
- JavaScript是面向对象的，但基于prototype(原型), 而不是使用类

  - 需要模拟，需要处理封装、多态等问题
  - 更加灵活
  - 使用闭包

- 函数在 ECMAScript中是对象，不是一种数据类型。

- 但函数也确实有一些特殊的属性，因此通过 typeof 操作符来区分函数和其他对象是有必要的

- 数据属性

  - [[Configurable]] 表示能否通过 delete 删除属性从而重新定义属性，能否修改属性的特性，或者能否把属性修改为访问器属性
  - [[Enumerable]] 表示能否通过 for-in 循环返回属性
  - [[Writable]]
  - [[Value]]

- 访问器属性

  - [[Configurable]]
  - [[Enumerable]]
  - [[Get]]
  - [[Set]]

- 两个内置对象/单体内置对象

```javascript
var person = {};
Object.defineProperty(person, "name", {
  writable: false,
  value: "Nicholas"
});
console.log(person.name); //"Nicholas"
person.name = "Greg";
console.log(person.name); //"Nicholas"

// 一旦把属性定义为不可配置的，就不能再把它变回可配置了
var person = {};
Object.defineProperty(person, "name", {
  configurable: false,
  value: "Nicholas"
});
//抛出错误
Object.defineProperty(person, "name", {
  configurable: true,
  value: "Nicholas"
});

// 定义访问器属性
var book = {
    _year: 2004,
    edition: 1
};
Object.defineProperty(book, "year", {
  get: function(){
      return this._year;
  },
  set: function(newValue){
      if (newValue > 2004) {
          this._year = newValue;
          this.edition += newValue - 2004;
      }
  }
});

book.year = 2005;
console.log(book.edition); //2

// 定义多个属性
var book = {};
Object.defineProperties(book, {
  _year: {
      value: 2004
  },
  edition: {
      value: 1
  },
  year: {
      get: function(){
          return this._year;
      },
      set: function(newValue){
          if (newValue > 2004) {
             this._year = newValue;
              this.edition += newValue - 2004;
          }
      }
  }
});

// 取得Global对象的一种方法
var global = function(){
return this;
}();
```

# 创建对象

```javascript
var person= {}; // 少用new
person.firstname="John";
person.run  = function(){}; // 自动添加属性

// 添加方法到对象
function person(firstname,lastname,age,eyecolor) {
  this.firstname=firstname;
  this.lastname=lastname;
  this.age=age;
  this.eyecolor=eyecolor;

  // 方法
  this.changeName=changeName;
  function changeName(name) {
     this.lastname=name;
  }

}
myFather = new person("John","Doe",50,"blue");
myFather.changeName("Doe");
```

## Number对象

- 最大值±1.7976931348623157 x 10308，最小值为±5 x 10 -324
- 整数（不使用小数点或指数计数法）最多为 15 位。
- 小数的最大位数是 17，但是浮点运算并不总是准确
- JavaScript 浮点数运算的精度问题

  - <http://www.css88.com/archives/7340>
  - <https://www.cnblogs.com/Stephenchao/p/5743805.html>

```javascript
var x = 0.2+0.1; // 输出结果为 0.30000000000000004
var y = 0377; // 八进制
var z = 0xFF; // 十六进制

var myNumber=128;
myNumber.toString(16); // 返回 80
myNumber.toString(8); // 返回 200
myNumber.toString(2); // 返回 10000000
```

- 荒唐现象

```javascript
var c = rate_tax_yzf = 0.11,
    rateTaxYzf = c,
    a = 0.11,

    rate_price_yzf = 31.532,
    ratePriceYzf = 31.352,
    b = 31.352;

console.log(rateTaxYzf, ratePriceYzf, (rateTaxYzf+1) * ratePriceYzf);
console.log(rate_tax_yzf, rate_price_yzf, (rate_tax_yzf+1) * rate_price_yzf);
console.log(a, b, (a+1)*b);

// 0.11 31.352 34.800720000000005
// 0.11 31.532 35.00052
// 0.11 31.352 34.800720000000005
```

- 无穷大Infinity
- NaN - 非数字值

```javascript
var x = 1000 / "Apple"; // true
var x = 100 / "1000"; // still Number, return true
var x = 1000 / 0; // false
to judge: isNaN(x)

var x = 123;
var y = new Number(123);
typeof(x) // return Number
typeof(y) // return Object
(x === y) // false
```

## String对象

- API

  - charAt() charCodeAt() fromCharCode()
  - indexOf() lastIndexOf()
  - concat() match() replace() search()
  - slice() split()
  - substr() substring()
  - toLowerCase() toUpperCase()
  - valueOf()
  - localeCompare()

```javascript
// 3个s方法
var stringValue = "hello world";
console.log(stringValue.slice(3)); //"lo world"
console.log(stringValue.substring(3)); //"lo world"
console.log(stringValue.substr(3)); //"lo world"
console.log(stringValue.slice(3, 7)); //"lo w"
console.log(stringValue.substring(3,7)); //"lo w"
console.log(stringValue.substr(3, 7)); //"lo worl"

// 如果是负数
var stringValue = "hello world";
console.log(stringValue.slice(-3)); //"rld"
console.log(stringValue.substring(-3)); //"hello world"
console.log(stringValue.substr(-3)); //"rld"
console.log(stringValue.slice(3, -4)); //"lo w"
console.log(stringValue.substring(3, -4)); //"hel"
console.log(stringValue.substr(3, -4)); //"" （空字符串）

// charCodeAt
var stringValue = "hello world";
console.log(stringValue.charCodeAt(1)); // 输出"101"

// fromCharCode() 方法
console.log(String.fromCharCode(104, 101, 108, 108, 111)); //"hello"

// concat
var stringValue = "hello ";
var result = stringValue.concat("world", "!");
console.log(result); //"hello world!"
console.log(stringValue); //"hello"

// 操作基本类型值的语句一经执行完毕，
// 就会立即销毁新创建的包装对象
var s1 = "some text";
s1.color = "red";
console.log(s1.color); //undefined

var obj = new Object("some text");
console.log(obj instanceof String); //true

// 使用 new 调用基本包装类型的构造函数
// 与直接调用同名的转型函数是不一样的
var value = "25";
var number = Number(value); //转型函数
console.log(typeof number); //"number"
var obj = new Number(value); //构造函数
console.log(typeof obj); //"object"
```

## Date对象

- API

  - getFullYear() 获取年份

  - getTime() 返回从 1970 年 1 月 1 日至今的毫秒数

  - setFullYear() 设置具体的日期

  - toUTCString() 将当日的日期（根据 UTC）转换为字符串

  - 使用getDay() 和数组来显示星期，而不仅仅是数字。

  - 简化的两种方法

    - Date.parse()
    - Date.UTC()

  - toDateString() ----以特定于实现的格式显示星期几、月、日和年；

  - toTimeString() ----以特定于实现的格式显示时、分、秒和时区；

  - toLocaleDateString() ----以特定于地区的格式显示星期几、月、日和年；

  - toLocaleTimeString() ----以特定于实现的格式显示时、分、秒；

  - toUTCString() ----以特定于实现的格式完整的 UTC 日期。

```javascript
new Date() // 当前日期和时间
new Date(milliseconds) //返回从 1970 年 1 月 1 日至今的毫秒数
new Date(dateString)
new Date(year, month, day, hours, minutes, seconds, milliseconds)

var today = new Date()
var d1 = new Date("October 13, 1975 11:13:00")
var d2 = new Date(79,5,24)
var d3 = new Date(79,5,24,11,33,0)

var myDate=new Date();
myDate.setFullYear(2010,0,14);
myDate.setDate(myDate.getDate() + 5);

// 比较
var x=new Date();
x.setFullYear(2100,0,14);
var today = new Date();

if (x>today) { console.log("今天是2100年1月14日之前"); }
else { console.log("今天是2100年1月14日之后"); }

// 简化
// var someDate = new Date(Date.parse("May 25, 2004"));
var someDate = new Date("May 25, 2004");
console.log(someDate);

// GMT 时间 2000 年 1 月 1 日午夜零时
var y2k = new Date(Date.UTC(2000, 0));

// GMT 时间 2005 年 5 月 5 日下午 5:55:55
var allFives = new Date(Date.UTC(2005, 4, 5, 17, 55, 55));

//取得开始时间
var start = Date.now();
// var start = +new Date(); // 另一种方法
//调用函数
doSomething();
//取得停止时间
var stop = Date.now(),
result = stop – start;
```

## Array对象

- 合并两个或三个数组 - concat()
- 删除末尾 - pop()
- 末尾新增 - push()
- 删除开头元素 - shift()
- 开头新增 - unshift()
- 从一个数组中选择元素 - slice()
- 在数组的第2位置添加一个元素 - splice()
- sort() reverse()
- 数组 -> 字符串 -toString()
- 字符串 -> 数组 - join()

```javascript
Array.prototype.myUcase=function(){ coding... };
```

## Boolean对象

```javascript
var b1=new Boolean(0);
var b1=new Boolean(-0);
var b3=new Boolean("");
var b4=new Boolean(null);
var b5=new Boolean(NaN);
var b1=new Boolean(false);
var b1=new Boolean(undefined);
var b6=new Boolean("false"); // true
var b2=new Boolean(1); // true, others are false

// 布尔表达式中的所有对象都会被转换为 true
var falseObject = new Boolean(false);
var result = falseObject && true;
console.log(result); //true

var falseValue = false;
result = falseValue && true;
console.log(result); //false
```

## Math算数对象

- var y = Math.sqrt(16);
- Math.E Math.PI
- Math.SQRT2 Math.SQRT1_2
- Math.LN2 Math.LN10
- Math.LOG2E Math.LOG10E

```javascript
// random方法
function selectFrom(lowerValue, upperValue) {
    var choices = upperValue - lowerValue + 1;
    return Math.floor(Math.random() * choices + lowerValue);
}
var num = selectFrom(2, 10);
console.log(num); // 介于 2 和 10 之间（包括 2 和 10）的一个数值
```

## RegExp

- <http://www.regular-expressions.info>

- 模式的局限性

- 匹配字符串开始和结尾的 \A 和 \Z 锚
- 向后查找（lookbehind）
- 并集和交集类
- 原子组（atomic grouping）
- Unicode 支持（单个字符除外，如 \uFFFF ）
- 命名的捕获组
- s （single，单行）和 x （free-spacing，无间隔）匹配模式
- 条件匹配
- 正则表达式注释

```javascript
// 匹配第一个"bat"或"cat"，不区分大小写
var pattern2 = /[bc]at/i;

// 匹配所有以"at"结尾的 3 个字符的组合，不区分大小写
var pattern3 = /.at/gi;

// 匹配所有".at"，不区分大小写
var pattern4 = /\.at/gi;

// 创建
var re = new RegExp("\\w+");
var re = /\w+/; // 转义字符

// 示例1
var str="Is this all there is?";
var patt1=/is/gi; // 全局查找 不区分大小写
document.write(str.match(patt1)); // Is,is,is

// 示例2 test方法
var str = 'runoob';
var patt1 = new RegExp('\\w', 'g'); // 有转义作为正则表达式处理
var patt2 = new RegExp('\w', 'g'); // 无转义作为字符串处理
var patt3 =/\w+/g; // 与 patt1 效果相同
document.write(patt1.test(str)) // true
document.write("<br>")
document.write(patt2.test(str)) // false
document.write("<br>")
document.write(patt3.test(str)) // true

// 示例3 exec方法
var patt1=new RegExp("e"); // 找到返回值是被找到的值。如果没有,返回 null
document.write(patt1.exec("The best things in life are free")); // e

// RegExp 实例属性
var pattern1 = /\[bc\]at/i;
console.log(pattern1.global); //false
console.log(pattern1.ignoreCase); //true
console.log(pattern1.multiline); //false
console.log(pattern1.lastIndex); //0
console.log(pattern1.source); //"\[bc\]at"

var pattern2 = new RegExp("\\[bc\\]at", "i");
console.log(pattern2.global); //false
console.log(pattern2.ignoreCase); //true
console.log(pattern2.multiline); //false
console.log(pattern2.lastIndex); //0
console.log(pattern2.source); //"\[bc\]at"

// RegExp 实例方法
var text = "mom and dad and baby";
var pattern = /mom( and dad( and baby)?)?/gi;
var matches = pattern.exec(text);
console.log(matches.index); // 0
console.log(matches.input); // "mom and dad and baby"
console.log(matches[0]); // "mom and dad and baby"
console.log(matches[1]); // " and dad and baby"
console.log(matches[2]); // " and baby"
```
