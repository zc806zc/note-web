# lhgdialog写弹框

```javascript
/**
 * 新增商品
 */
function addProductBox(options) {
    var settings = {
        title: '',
        self: '',  // 弹框父级外围元素
        parent: '' // 弹框所在页面
    };
    this.settings = $.extend(settings, options);
    this.body = $(this.settings.self);
    this.ready();
    return this;
}

var addProductBoxExtend = {
    // 接口
    url: {},

    // 弹框对象
    dialogIndex: null, // 用于关闭

    // 初始化
    ready: function () {

        this.showDialog(); // 默认打开弹框

        // 数据初始化

        // 初始化绑定事件
        this.bindEvent();

    },

    // 显示弹框
    showDialog: function () {
        var body = this.body,
            title = this.settings.title;
        this.body.show();
        var $this = this;

        this.dialogIndex = $.dialog({
            title: title,
            content: body,
            // zIndex: 700, // 弹框上弹框，注释这一行
            init: function () {
                var wrap = this.DOM.wrap;
                wrap.css({opacity: "0"}).animate({opacity: "1"}, 500);
            },
            ok: false, // 不用原生
            close: function () {
                $this.reset(); // 重置
            },
            esc: false,
            lock: true,
            min: false,
            max: false,
            resize: false,
            drag: false
        });
    },

    // 监听事件绑定
    bindEvent: function () {
        var $this = this;

        this.bindSubmitBtn();
        this.bindCloseDialog();
    },


    // 提交按钮
    bindSubmitBtn: function () {
        var $this = this;
        this.body.find('.btn-submit').off('click').on('click', function () {

            $this.dialogIndex.close();
        });
    },

    // 关闭弹框
    bindCloseDialog: function () {
        var $this = this;
        var dom = this.body.find('.btn-cancel');
        dom.off('click').on('click', function () {
            $this.dialogIndex.close();
        });
    },

    // 表单校验
    checkForm: function () {
        return true;
    },

    // 弹框隐藏/表单重置
    reset: function () {
        // 表单重置
        var body = this.body;
        body.find('input, textarea').val('');

        // 弹框重置并隐藏
        body.appendTo(this.settings.parent).hide();
    }

};
$.extend(addProductBox.prototype, addProductBoxExtend);
```

# layer写弹框

- HTML

```html
<script id="tmpl_report_time" type="text/html">

    <div class="layui-form _layer-report-time" lay-filter="form-report-time">

        <div class="layui-form-item">
            <label class="layui-form-label">地区</label>
            <div class="layui-form-mid layui-word-aux"> {{ d.username }} </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">当月开始上报日</label>
            <div class="layui-input-block">
                <input class="layui-input"
                       type="number"
                       value="{{ d.score }}"
                       min="1"
                       max="31"
                       name="report_date_begin"
                       lay-verify="number"
                       lay-vertype="tips"
                       autocomplete="off">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">次月截止上报日</label>
            <div class="layui-input-block">
                <input class="layui-input"
                       type="number"
                       value="{{ d.logins }}"
                       min="1"
                       max="31"
                       name="report_date_end"
                       lay-verify="number"
                       lay-vertype="tips"
                       autocomplete="off">
            </div>
        </div>

        <!-- 按钮区 -->
        <div class="layui-form-item">
            <div class="layui-input-block btn-group clearfix">
                <button type="button" class="layui-btn layui-btn-primary fr js-btn-cancel">取消</button>
                <button class="layui-btn layui-btn-default fr js-btn-submit" lay-submit=""
                        lay-filter="form-report-time">保存
                </button>
            </div>
        </div>
    </div>

</script>
```

- JS

```javascript
/**
 * 上报时间编辑弹框
 * ===================
 */
function layerReportTime(options) {
    // 配置信息(不指定就默认)
    var settings = {
        mode: 'edit',   // edit 编辑
        title: '上报时间',
        tmplId: null,   // 渲染弹框内容的模板ID
        data: null,      // 数据

        index: null,    // 弹框索引
        body: null     // 弹框内容
    };
    this.settings = $.extend(settings, options); // 配置信息覆盖

    this.ready(); // 指定入口函数
    return this;
}

var layerReportTimeExtend = {

    // 接口
    url: {},

    // 弹框
    layerIndex: null, // 用于关闭

    // 入口
    ready: function () {
        this.showLayer(); // 打开弹框
        this.bindEvent();
    },


    // 绑定初始化事件
    bindEvent: function () {

    },

    // 弹框显示
    showLayer: function () {
        var that = this;
        var settings = that.settings,
            title = settings.title,
            tmplId = settings.tmplId,
            data = settings.data,
            content = that.getLayerContent(tmplId, data);

        layer.open({
            type: 1,
            title: title,
            shadeClose: true,
            maxmin: false,
            content: content,
            success: function (layero, index) {
                that.markLayer.call(that, layero, index);  // 标记弹框索引
                that.bindCancel.call(that, layero, index); // 取消关闭
                that.bindSubmit.call(that, layero, index); // 提交

                form.render(null, 'form-report-time'); // 表单重载
            }
        });

    },

    // 标记弹框
    markLayer: function (layero, index) {
        this.settings.body = layero;
        this.settings.index = index;
    },

    // 获取弹框内容
    getLayerContent: function (tmplId, data) {
        var content = document.getElementById(tmplId).innerHTML;

        // 有数据则进行渲染再输出
        if (data) {
            laytpl(content).render(data, function (html) {
                content = html;
            });
        }

        return content;
    },

    // 数据渲染弹框内容
    setLayerContent: function (tmplId, data) {
        var content = document.getElementById(tmplId).innerHTML;

        // 有数据则进行渲染
        if (data) {
            var a  = laytpl(content).render(data, function (html) {
                // $this.layerBodyMain.find('.compute-box').html(html).show();
            });
            debugger
        }
    },

    // 提交
    bindSubmit: function (layero, index) {
        var that = this;

        form.on('submit(form-report-time)', function (data) {
            var param = data.field; // 查询所需的参数

            param.areaId = that.settings.data.id;

            layer.alert(JSON.stringify(param));

            // $.ajax({
            //     type: "post",
            //     url: $this.url.addArea,
            //     data: obj,
            //     success: function (res) {
            //         if (res.code === 0) {
            //             // $this.reloadTable();
            //
            //             layer.msg(res.msg,{time: 1200});
            //             layer.close(index); // 关闭弹框
            //
            //         } else{
            //             layer.alert(res.msg);
            //         }
            //     }
            // });
        });
    },

    // 弹框关闭
    bindCancel: function (layero, index) {
        var that = this;
        var btnCancel = layero.find('.js-btn-cancel');

        btnCancel.on('click', function () {
            layer.close(index);
        });
    }
};
$.extend(layerReportTime.prototype, layerReportTimeExtend); // 扩展弹框方法
```

# 重构

- <https://juejin.im/post/5a029d986fb9a044fb072efb>

- 网站重构

  - 雪碧图

    - <http://www.imooc.com/learn/93>

- typo.css <https://github.com/sofish/typo.css>

  - 中文网页重设与排版：一致化浏览器排版效果，构建最适合中文阅读的网页排版

```javascript
// 建议
先易后难(命名格式->模块化）
持续测试（不要大量重构后测试）

// 存在问题
代码组织混乱 CSS，JS，HTML掺杂、布局随意(例用<br>增距)
HTML代码不符合标准(废弃元素 marquee 因为可以用JS实现)

性能上没有缓存，动态加载，脚本压缩，图片压缩

// 优化措施
不断查看上下文,删除无效代, 即使一些误删导致了bug也是值得的
代码规范化，缩小作用域
{
  模块化
  命名空间
  公共方法独立
  面向对象，共有私有接口
}

整理基础类库 例EXT JS和Jquery的重复

// 提高加载性能
CSS Sprite，合并首页背景图
延长静态资源缓存时间

// W3C指定的标准
structure HTML4.01
presentation CSS2
behavior ECMA DOM

// 合并代码文件
YUI Compresser -> Java
Web Optimization -> .NET
```

- 常用的文件组织结构

```javascript
--js
    --lib
    --custom.js
--css
    --lib
    --images(样式中的背景图)
    --reset.css
    --custom.js
--resource
--index.html

// 文件命名
jquery-1.8.2.min.js
bootstrap-responsive.css
```

# 资源更新

- 版本号
- 资源路径缓存

# react重构

- <https://juejin.im/post/5a4a6f35f265da4335631d83?utm_medium=fe&utm_source=weixinqun>
